{"version":3,"sources":["../src/loader.ts"],"sourcesContent":["import type { MoonPayWebSdkInitFn, WindowMoonPayWebSdk } from '@web-sdk';\ndeclare const window: Window & WindowMoonPayWebSdk;\n\nconst scriptLoadingStatus = {\n  isLoading: false,\n  isLoaded: false,\n};\n\nexport async function loadMoonPay(\n  version: string | null = 'v1',\n): Promise<MoonPayWebSdkInitFn | undefined> {\n  return new Promise((resolve, reject) => {\n    const scriptSrc = `https://static.moonpay.com/web-sdk/${version}/moonpay-web-sdk.min.js`;\n    const existingScript = document.querySelector(`script[src=\"${scriptSrc}\"]`);\n\n    scriptLoadingStatus.isLoading = true;\n\n    const checkLoaded = (count = 0) => {\n      if (window.MoonPayWebSdk) {\n        scriptLoadingStatus.isLoading = false;\n        scriptLoadingStatus.isLoaded = true;\n        resolve(window.MoonPayWebSdk.init);\n        return;\n      }\n\n      // Timeout after 10 seconds\n      if (count > 100) {\n        scriptLoadingStatus.isLoading = false;\n        reject(new Error('Loading MoonPayWebSdk script timed out.'));\n        return;\n      }\n\n      setTimeout(() => checkLoaded(count + 1), 100);\n    };\n\n    if (existingScript) {\n      checkLoaded();\n    } else {\n      const script = document.createElement('script');\n      script.async = true;\n      script.src = scriptSrc;\n\n      script.addEventListener('load', () => {\n        scriptLoadingStatus.isLoading = false;\n        scriptLoadingStatus.isLoaded = true;\n        resolve(window.MoonPayWebSdk?.init);\n      });\n\n      script.addEventListener('error', () => {\n        scriptLoadingStatus.isLoading = false;\n        scriptLoadingStatus.isLoaded = false;\n        reject(new Error('Failed to load MoonPayWebSdk script.'));\n      });\n\n      document.body.appendChild(script);\n    }\n  });\n}\n\nexport type MoonPayWebSdk = NonNullable<ReturnType<MoonPayWebSdkInitFn>>;\n"],"mappings":";AAGA,IAAM,sBAAsB;AAAA,EAC1B,WAAW;AAAA,EACX,UAAU;AACZ;AAEA,eAAsB,YACpB,UAAyB,MACiB;AAC1C,SAAO,IAAI,QAAQ,CAAC,SAAS,WAAW;AACtC,UAAM,YAAY,sCAAsC,OAAO;AAC/D,UAAM,iBAAiB,SAAS,cAAc,eAAe,SAAS,IAAI;AAE1E,wBAAoB,YAAY;AAEhC,UAAM,cAAc,CAAC,QAAQ,MAAM;AACjC,UAAI,OAAO,eAAe;AACxB,4BAAoB,YAAY;AAChC,4BAAoB,WAAW;AAC/B,gBAAQ,OAAO,cAAc,IAAI;AACjC;AAAA,MACF;AAGA,UAAI,QAAQ,KAAK;AACf,4BAAoB,YAAY;AAChC,eAAO,IAAI,MAAM,yCAAyC,CAAC;AAC3D;AAAA,MACF;AAEA,iBAAW,MAAM,YAAY,QAAQ,CAAC,GAAG,GAAG;AAAA,IAC9C;AAEA,QAAI,gBAAgB;AAClB,kBAAY;AAAA,IACd,OAAO;AACL,YAAM,SAAS,SAAS,cAAc,QAAQ;AAC9C,aAAO,QAAQ;AACf,aAAO,MAAM;AAEb,aAAO,iBAAiB,QAAQ,MAAM;AACpC,4BAAoB,YAAY;AAChC,4BAAoB,WAAW;AAC/B,gBAAQ,OAAO,eAAe,IAAI;AAAA,MACpC,CAAC;AAED,aAAO,iBAAiB,SAAS,MAAM;AACrC,4BAAoB,YAAY;AAChC,4BAAoB,WAAW;AAC/B,eAAO,IAAI,MAAM,sCAAsC,CAAC;AAAA,MAC1D,CAAC;AAED,eAAS,KAAK,YAAY,MAAM;AAAA,IAClC;AAAA,EACF,CAAC;AACH;","names":[]}